<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title>Node-1-Local</title>
    <meta charset="utf-8">
    <meta name="description" content="getWid">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<script src="./jquery.min.js"></script>
    <!-- Local copies of bootstrap -->
    <link rel="stylesheet" href="./bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="./bootstrap/css/bootstrap-theme.min.css">
    <script src="./bootstrap/js/bootstrap.min.js"></script>

    <script src="./async.js"></script>
    <script src="et-utils.js"></script>	
    <script src="config-local.js"></script>

	<script src="et-security.js"></script>
    <script src="config-local.js"></script>
    <script src="executethis.js"></script>
	<script src="et-query.js"></script>
	<!-- <script src="et-testing.js" type="text/javascript"></script> -->
	<script src="et-unit_tests.js"></script>

	<script src="et-get.js"></script>
	<script src="et-add.js"></script>

	<script src="et-test.js"></script>
	<script src="et-unit_tests.js"></script>
    <script src="et-dto.js"></script>
	<script src="cody.js"></script>
	<script src="addhoc.js"></script>
	<script src="secdata.js"></script>
	
	<!-- <script src="et-testing.js" type="text/javascript"></script> -->
<style  type="text/css">
        body {
        padding-top: 15px;
        padding-bottom: 20px;
        background-color: #fce7bd;
    }

	#storageSpaceBar {
    	background-color: #000000;
  	  	color:#FFFFFF; 
	}

	#storageSpaceValue {
	    padding: 3px;
	    margin-bottom: 5px;
	    background-color: #7BA1E2; 
	    width: 0%;
	}
</style>
<script type="text/javascript">

// This example fires without a callback
function test4(params) {
	alert ("test4 fired with these params:\n" + JSON.stringify(params));
	return params;
}
	// storage is the total possible in local storage 
	//http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"
	// A formula for this is var storage = 1024 * 1024 * 5 - unescape(encodeURIComponent(JSON.stringify(localStorage))).length;
	var storage = 5229349;
	// localStorage.setItem("totalStorage", storage);
	var storageSpace = storage;//localStorage.getItem("totalStorage");
	var currentStorageSpace = 1024 * 1024 * 5 - unescape(encodeURIComponent(JSON.stringify(localStorage))).length; 
	var percentageLeft = Math.round((currentStorageSpace / storageSpace) * 100);
	function updateMemory () {
		$('#storageSpaceValue').css('width', percentageLeft + "%");
		$('#storageSpaceText').text("Remaining Storage: " + percentageLeft + "%  --  Actual bytes used: " + (storageSpace - currentStorageSpace));
	}
</script>

</head>
<body>
<!-- 
<div id='storageSpaceBar'>
   	<div id='storageSpaceValue'>
      <div id='storageSpaceText'></div>
   </div>
</div>
--> 

<div class='container'>
	<div class='row'>
		<div class='col-md-12'>
			<input id='execute_test' class='btn btn-primary' type='button' value='Run Test'/>
			<input id='execute_function' class='btn btn-primary' type='button' value='Run Function'/>
			<input id='execute_server_test' class='btn btn-primary' type='button' value='Run Server Test'/>
			<input id='execute_server_function' class='btn btn-primary' type='button' value='Run Server Function'/>
			<input id='et-test' class='btn btn-primary' type='button' value='et'/>
			<input id='get_copy' class='btn btn-info' type='button' value='Copy for get wid'/>
			<input id='add_copy' class='btn btn-info' type='button' value='Copy for add wid'/>
			<input id='output_to_input' class='btn btn-warning' type='button' value='Output to Input'/>

			<br><br>
			<label>Function: </label>
			<input id='function_to_run' size='20' value=''>
<!--
			<label>Server call ? </label><input type='checkbox' id='server_caller'>
-->		
			<label id='test_result_message' style='padding-left: 6em;'></label>
	 		<!-- <input id='mybutton' class='btn btn-warning' type='button' value='Show/Hide Local Storage'/>  -->
		</div> <!-- end of col-md-12> -->
	</div> <!-- end of row -->
	<br>
	<div>

	<div class='row'>   
	    <div class="col-md-12">
	        <span class="label label-default well_hider">Debug</span>
	            <div class="well" style='display: none;'>
					<label>Debug? </label>				<input type='checkbox' id='debugon'>
					<label>Destination: Print? </label>	<input type='checkbox' id='dest_print' checked>
					<label> Google? </label>			<input type='checkbox' id='dest_google'>
					<label> Debug Level? </label>		<input id='dbug_level' size='3' value=''>
					<br>
					<label>Name: </label>				<input id='dbug_name' size='20' value=''>
					<label>Category: </label>			<input id='dbug_category' size='20' value=''>
					<label>Subcategory: </label>		<input id='dbug_subcategory' size='20' value=''>
					<label>Filter: </label>				<input id='dbug_filter' size='20' value=''>
	            	<!-- <textarea id="function_parameters" class='test_content col-md-12 col-sm-12' rows='3'></textarea> -->

	            </div>
		</div> <!-- end of col-md-12 -->
	</div> <!-- end row -->
	<br>


	<!--
		<span class='test_example'>
			<b>Function Parameters :</b></br>
		</span>

		<span class='test_content' style='display: none;'></br>
			<textarea rows="5" cols="100" id="function_parameters">{"executethis":"querywid", "mongowid":["abcWid","qrsWid"],"mongorelationshiptype":"attributes", "mongorelationshipdirection":"forward","mongorelationshipmethod":"all","mongowidmethod":"orange"}</textarea>
		</span>
-->
		 <div class='row'>   
		    <div class="col-md-12">
		        <span class="label label-default well_hider">Function Parameters :</span>
		            <div class="well" style='display: none;'>
		            	<textarea id="function_parameters" class='test_content col-md-12 col-sm-12' rows='3'></textarea>
		            </div>
			</div> <!-- end of col-md-12 -->
		</div> <!-- end row -->


	</div>
	<br>
	<input class='btn btn-mini btn-info' type="button" value="Execute This" onclick="javascript:testexecutethis()"/>

	<input class='btn btn-mini btn-info' type="button" value="ConvertToDOT" onclick="javascript:testconverttodot()" style='float:right;'/>
	<input class='btn btn-mini btn-info' type="button" value="ConvertFromDOT" onclick="javascript:testconvertfromdot()"  style='float:right;'/><br><br>

	<div class='row'>
		<div class='col-md-1 col-lg-1'>
	    	<input id='radio_short' type = 'radio' Name='output_type' value = 'short'>&nbspMin<br>
	    	<input id='radio_long'  type = 'radio' Name='output_type' value = 'long' checked = 'true'>&nbspMax
		</div>
	    <div class="col-md-11 col-lg-11">
	        <span class="label label-default well_hider">Function Output</span>
	            <div class="well" style='display: block;'>
	            	<pre id="Function_Output">
	            		<div id='short_output'>area 1</div>
	            		<div id='long_output' style='display:none'>area 2</div>

	            	</pre>
	            </div>
		</div> <!-- end of col-md-12 -->

	</div> <!-- end row -->
	<br>

    <div class='row'>   
    	<div class='col-md-1 col-lg-1'>
	    	<input id='data_local_storage' 	type='radio' Name='data_type' value = 'storage'>&nbspLocal<br>
	    	<input id='data_store'  		type='radio' Name='data_type' value = 'store'>&nbspStore<br>
	    	<input id='data_wid'  			type='radio' Name='data_type' value = 'wid'>&nbspWid
    	</div>
	    <div class="col-md-11 col-lg-11">
	        <span class="label label-default well_hider">Data</span>
	            <div class="well" style='display: block;'>
	            	<pre id="local_data">---------</pre>
	            </div>
		</div> <!-- end of col-md-9 -->
	</div> <!-- end row --> 
	<br>
<!-- 
    <div class='row'>   
	    <div class="col-md-12">
	        <span class="label label-default well_hider">Local Storage Wids</span>
	            <div class="well" style='display: none;'>
	            	<pre id="divwidsdisplay_from_local_storage">---------</pre>
	            </div>
		</div> 
	</div> 
	<br>

	 <div class='row'>   
	    <div class="col-md-12">
	        <span class="label label-default well_hider">locatStore memory object's JSON property</span>
	            <div class="well" style='display: none;'>
	            	<pre id="divwidsdisplay_from_memory">---------</pre>
	            </div>
		</div> 
	</div> 
	<br>
-->
	<div class='row'>
		<div class="col-md-12">
	        <span class="label label-default well_hider">DivPrint Output</span>
	            <div class="well"><pre id="divprint">---------</pre></div>
		</div> <!-- end of col-md-12 -->
	</div>



</div> <!-- end container -->
<script>
// http://www.2ality.com/2013/06/basic-javascript.html 
// <input type="button" value="Raw Mongo Query" onclick="javascript:testrawmongoquery();" />
//<input type="button" value="testDataQuery" onclick="javascript:testQueryWid ();" />
// <input type="button" value="MongoDataQuery" onclick="javascript:testMongoQuery();" />
// This is for the funcitonality of the testing screen itself
// $('#mybutton').click(function () {
//   if ($('#divwidsdisplay').css('display') == 'block'){
//     $('#divwidsdisplay').hide('slow');
//   }
//   else{
//   	displayAllWids();
//     $('#divwidsdisplay').show('slow');
//   }
// });

// This is for the funcitonality of the testing screen itself
$('.well_hider').click(function () {
  var test = $(this).next('.well');
  if ($(test).css('display') != 'none'){
    $(test).hide('slow');
  }
  else{
  	// displayAllWids();
    $(test).show('slow');
  }
});

// This will run activate all the passing tests to insure they still work
//[{"executethis":"query","query": {"$or": [{"wid":"joetestwid" }]}}]
$('#runAllTests').click(function () {
	RerunPassingTests();
});

$('#debugon').change(function () {
	//alert('The checkbox changed');
	if($('#debugon').is(':checked')) {	
		//alert('true');
		Debug = 'true';
	} else {
		//alert('false');
		Debug = 'false';
	}
})

//This defines how data is stored and retrieved with local storage.
//clearLocalStorage()
$(document).ready(function () {
	Debug = 'false';
	bootprocess();
	// $('dest_print').prop("checked", true);
});

function execute_stuff(isTest, isServer) {
	// bootprocess();

	// Pulling values out of the debug area
	debugname = $('#dbug_name').val(); 
	debugcat = $('#dbug_category').val();
	debugsubcat = $('#dbug_subcategory').val();
	debugfilter = $('#dbug_filter').val();
	if ($('#dbug_level').val() != "") debuglevel = parseInt($('#dbug_level').val());

	if ( $('#dest_print').is(':checked') && !$('#dest_google').is(':checked') ) debugdestination = 1;
	if ( !$('#dest_print').is(':checked') && $('#dest_google').is(':checked') ) debugdestination = 2;
	if ( $('#dest_print').is(':checked') && $('#dest_google').is(':checked') ) debugdestination = 3;

	// localStorage.clear();
	$('#resultDiv').text("");
	$('#test_result_message').text("");
	$('#divprint').text("");
	var function_to_execute = $('#function_to_run').val();

	// check to make sure the test string is in the right format
	// if(function_to_execute.indexOf("ettest") === -1) {
	// 	function_to_execute = "ettest" + function_to_execute;
	// }

	var my_execute_object = {"executethis":function_to_execute};

	// if ($('#server_caller').prop('checked')) {		
	if (isServer) {		
		my_execute_object['configuration'] = {
	        "midexecute": [
	            {
	                "dothis": "server",
	                "tryorder": 0,
	                "executeorder": 0,
	                "params": {}
	            }
	        ]
	    };
	}
	// execute(my_execute_object, show_function_output);
	execute(my_execute_object, show_function_output3);

	//var result = executethis(my_execute_object);
/*	var result_count = Object.keys(result).length;

	// var y = verifysummary("test_results");
	var y = 0; // verifysummary_local(result);
	if (result_count > 0 && isTest) y = verifysummary_local(result);
	// if (result.hasOwnProperty('executethis') && result_count == 1) {
	// 	alert ('Something when wrong with the test...all your function returned was ' + JSON.stringify(https://developer.mozilla.org/en-US/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScriptresult));
	// } else 
	if (y['resultwid'] == "PASS" || y['resultwid'] == "FAIL" && isTest) { 
		showPassFail(y) 
	};

	// var x = getfromlocal({"wid":"test_results"});
	// console.log('x=' + JSON.stringify(x));
	if (result_count > 0) {
		$('#Function_Output').text(JSON.stringify(result));
	} else {
		$('#Function_Output').text("empty");
	}
	// $('#resultDiv').text(JSON.stringify(x));

	if (exports.environment == 'local') displayAllWids();
	// if ((typeof localStore) !== "undefined") {
		displaylocalStore();
	// } else {
	// 	document.getElementById("divwidsdisplay_from_memory").innerHTML = "<label style='color: red; font-size: 135%;'>localStore is undefined</label>";
	// }*/
}

$('#execute_test').click(function () {
	execute_stuff(true, false);
});

$('#et-test').click(function () {
	$('#function_to_run').val("ettest" + $('#function_to_run').val());
	execute_stuff(true, false);
});

$('#execute_function').click(function () {
	execute_stuff(false, false);
});

$('#execute_server_test').click(function () {
	execute_stuff(true, true);
});

$('#execute_server_function').click(function () {
	execute_stuff(false, true);
});

$('#get_copy').click(function () {
		var temp = $('#function_to_run').val();
		$('#function_parameters').text('{"getwidmaster":"' + temp + '"}');
});

$('#add_copy').click(function () {
		var temp = $('#function_to_run').val();
		$('#function_parameters').text('{"addwidmaster":"' + temp + '"}');
});

$('#output_to_input').click(function () {
		var temp = $('#Function_Output').text();
		$('#function_parameters').val(temp);
});

// function show_function_output (err, x) {
// 	$('#Function_Output').text(JSON.stringify(x));
// 	var result = x;
// 	var result_count = Object.keys(result[0]).length;

// 	// var y = verifysummary("test_results");
// 	var y = verifysummary_local(result[0]);
// 	if (result.hasOwnProperty('executethis') && result_count == 1) {
// 		alert ('Something when wrong with the test...all your function returned was ' + JSON.stringify(result));
// 	} else if ( (y['resultwid'] == "PASS" || y['resultwid'] == "FAIL") && result_count != 0 ) { 
// 		showPassFail(y) 
// 	};

// 	$('#Function_Output').text(JSON.stringify(result));

// 	if (exports.environment == 'local') displayAllWids();
// 	if ((typeof localStore) !== "undefined") {
// 		displaylocalStore();
// 	} else {
// 		document.getElementById("divwidsdisplay_from_memory").innerHTML = "<label style='color: red; font-size: 135%;'>localStore is undefined</label>";
// 	}
// }


function return_long (result_array) {
	// You don't know the outcome of the test yet.
	var ultimate_pass_fail = "UNKNOWN";
	var did_fail_flag = false;
	var did_pass_flag = false;
	var tmp_html_long = "";
	var tmp_output_long = "";

	for (var x in result_array) {
        var jsonPretty = JSON.stringify(result_array[x], "-", 4);
        tmp_html_long = jsonPretty;
    	tmp_output_long += "<pre>" + tmp_html_long + "</pre>";
    	// If a 'pass' is found, a pass 'could' happen.
	    if ( tmp_html_long.indexOf("PASS") !== -1 ) did_pass_flag = true;
	    // If a 'fail' is found, a fail 'could' happen.
	    if ( tmp_html_long.indexOf("FAIL") !== -1 ) did_fail_flag = true;
	}
	// If there is a pass with no fail, the data passes.
	if (did_pass_flag && !did_fail_flag) ultimate_pass_fail = "PASS";
	// If there are any fails at all, the data fails.
	if (did_fail_flag) ultimate_pass_fail = "FAIL";
	
	showPassFail(ultimate_pass_fail);
	return tmp_output_long;
}

function return_short (result_array) {
	// console.log("result_array: " + JSON.stringify(result_array));
	// console.log("result_array.length: " + result_array.length);

	var output_short = "";
	var name = ""; 	
	var status = "";

	if (result_array.length == 1) {
   		name = result_array[0]["test_name"];
   		status = result_array[0][name];
    	output_short += "\"" + name + "\":\"" + status + "\",";
	} else {
		for (var x in result_array) {	
			if (result_array[x] instanceof Array) {
				output_short += return_short(result_array[x]);
				} else {
				var tmp_array = [];
				tmp_array.push(result_array[x]);
				output_short += return_short(tmp_array);
			}
		}
	}
	return output_short;
}

function get_indexes_of(needle, haystack ) {
	var indexes = [];
	var n_length = needle.length;
	var h_length = haystack.length;
	for (var i=0; i < (h_length - n_length); i++) {
		if (haystack.substring(i,n_length) == needle) {
			indexes.push(i);
		}
	}
	return indexes;
}


function show_function_output3 (err, result_array) {

	$('#Function_Output').empty();
	var index = 0;
	var target = "";
	var tmp_html_short = "";
	var output_short = "<div id='short_output' style='display:block'>{";
	var output_long = "<div id='long_output' style='display:none'>";


	output_long += return_long(result_array);
	output_short += return_short(result_array);

	output_short = output_short.substring(0,output_short.length -1);
	output_short += "}</div>"
	output_long += "</div>"
	// console.log("output_short: " + output_short);
	// console.log("output_long: " + output_long);
	
	$('#Function_Output').append(output_short);
	$('#Function_Output').append(output_long);
}

function return_short_2(result_array) {


}

function show_function_output2 (err, result_array) {
	// Clear out the screen
	$('#Function_Output').empty();
	console.log('result_array: ' + JSON.stringify(result_array, "-", 4));
	var ultimate_pass_fail = "UNKNOWN";
	var index = 0;
	var target = "";
	var did_fail_flag = false;
	var did_pass_flag = false;

	var tmp_html_short = "";
	var tmp_html_long = "";

	var output_short = "<div id='short_output' style='display:block'>{";
	var output_long = "<div id='long_output' style='display:block'>";

	// Iterate throught the array
	for (var x in result_array) {
		console.log("x:" + x);
		// Convert the object to string
        var jsonPretty = JSON.stringify(result_array[x], "-", 4);
        console.log("Pretty: " +jsonPretty);
        // tmp_html_long = syntaxHighlight(jsonPretty);
        tmp_html_long = jsonPretty;

        // console.log("index: " + index);
		// console.log("tmp_html_long:" + tmp_html_long);
		var z=1;
		for (var i in result_array[x]) {
			if (z%2) {
				console.log("i:" + i);
				target = JSON.stringify(result_array[x][i]);
		        console.log("target: " + target );
		        // index = target.indexOf(',');
	            tmp_html_short = "\"" + i + "\": " + target + ",";

	            if (tmp_html_short.indexOf("{") != -1) {
					tmp_html_short = tmp_html_short.substring(tmp_html_short.indexOf('{'), tmp_html_short.indexOf(',') -1);        
	            }

				console.log("tmp_html_short:" + tmp_html_short);
		    	output_short += tmp_html_short;
				
		        // console.log("result_array["+ x + "][" + i + "]   " + target );
		    }
		    z++;
	        // tmp_html_short = tmp_html_long.substring(2,index) + "---";
		}
  
		// This works only on the first object of result_array
        // index = tmp_html_long.indexOf('string') + 21;

	    if ( tmp_html_long.indexOf("PASS") !== -1 ) did_pass_flag = true;
	    if ( tmp_html_long.indexOf("FAIL") !== -1 ) did_fail_flag = true;

	    output_long += "<pre>" + tmp_html_long + "</pre>";
	    // output_short += "<pre>" + tmp_html_short + "</pre>";

		if (did_pass_flag && !did_fail_flag) ultimate_pass_fail = "PASS";
		if (did_fail_flag) ultimate_pass_fail = "FAIL";
	}  

	// Strip off the comma of output_short
	output_short = output_short.substring(0, output_short.length -1);
	output_short += "}</div>"
	output_long += "</div>"
	// console.log("output_short: " + output_short);
	// console.log("output_long: " + output_long);
	$('#Function_Output').append(output_short);
	$('#Function_Output').append(output_long);
	showPassFail(ultimate_pass_fail);
}

		// console.log("did_pass_flag: " + did_pass_flag);
		// console.log("did_fail_flag: " + did_fail_flag);

exports.verifysummary_local = verifysummary_local = function verifysummary_local(resultsobject) {
	var testfailflag = "false";

	if (resultsobject !== undefined) {
		for (var result in resultsobject) {
			if (resultsobject[result] == "FAIL" || resultsobject[result] != "PASS" && resultsobject[result] != {}) {
				testfailflag='true';
			}
		}
	} 
	
	// The ultimate pass/fail	
	if (testfailflag == 'false') {
		return {"resultwid":'PASS'}
	} else {
		return {"resultwid":'FAIL'}
	}
}

// LM: Please leave this here
// $(document).keypress(function (e) {
//     if(e.which == 13) {
//     };
// });

function showPassFail (result) {

	document.getElementById("test_result_message").innerHTML="";
	if (result == 'PASS') {
		document.getElementById("test_result_message").style.color="green";
		document.getElementById("test_result_message").style.fontSize="250%";
		document.getElementById("test_result_message").innerHTML="PASS";
	} else 
	if (result == 'FAIL') {
		document.getElementById("test_result_message").style.color="red";
		document.getElementById("test_result_message").style.fontSize="250%";
		document.getElementById("test_result_message").innerHTML="FAIL";
	} else 
	if (result == 'UNKNOWN') {
		document.getElementById("test_result_message").style.color="blue";
		document.getElementById("test_result_message").style.fontSize="250%";
		document.getElementById("test_result_message").innerHTML="UNKNOWN";
	} 
}

function testgetwidmaster() {
	document.getElementById("divprint").innerHTML = "";
	try {
		var widParameters = JSON.parse(document.getElementById("function_parameters").value);
	} catch (e) {
		console.error("JSON Parsing error:", e);
		alert("JSON Parsing error:", e);
		return;
	}

	widParameters["executethis"] = "getwidmaster";
	var getwidresult = execute(widParameters, show_function_output);

	// document.getElementById("divprint").innerHTML = "";
	// //var convertMethod = 'wid';
	// //var widParameters = {"wid":"wid1", "dtotype":"widdto", "inherit":"inherit", "convertMethod":"wid", "accessToken":"AccessToken"};
	// var widParameters = JSON.parse(document.getElementById("function_parameters").value);

	// 	widParameters["executethis"] = "getwidmaster";
	// x = window['execute']
	// var getwidresult = executethis(widParameters, x);
	// //var getwidresult = executethis(widParameters);
	// updateMemory();
	// Display_Output(getwidresult);

	//printToDiv('Function testgetwidmaster getwidresult: ',  getwidresult, 'true');
}

function testaddwidmaster() {
	document.getElementById("divprint").innerHTML = "";
	try {
		var widParameters = JSON.parse(document.getElementById("function_parameters").value);
	} catch (e) {
		console.error("JSON Parsing error:", e);
		alert("JSON Parsing error:", e);
		return;
	}
	
	widParameters["executethis"] = "addwidmaster";
	var getwidresult = execute(widParameters, show_function_output);

	// document.getElementById("divprint").innerHTML = "";
	// //var widParameters = input;
	// var widParameters = JSON.parse(document.getElementById("function_parameters").value);
	
	// 	widParameters["executethis"] = "addwidmaster";

	// x = window['execute']
	// var getwidresult = executethis(widParameters, x);

	// //var getwidresult = executethis(widParameters);
	// updateMemory();
	// Display_Output(getwidresult);
	//displayAllWids();
	//if(widParameters["seq"]){
	//	widMasterKey = widParameters["seq"];
	//}	
	// if(widParameters["seq"]){
	// 	delete widParameters["seq"];
	// }
	// if(widParameters["command.action"]){
	// 	delete widParameters["command.action"];
	// }
}
//***************************************************************
// function testrawmongoquery() {
// 	document.getElementById("divprint").innerHTML = "";

// 	var widParameters = JSON.parse(document.getElementById("function_parameters").value);
	
// 		widParameters["executethis"] = "addwidmaster";

// 	var getwidresult = executethis(widParameters);
// 	updateMemory();
// 	Display_Output(getwidresult);

//       	execute(JSON.parse($("#function_parameters").val()),function (data) {
//         doAfterTesting(data);
//     }); 
// }

// function doAfterTesting(response){
//   alert('>>> from client code >>> '+JSON.stringify(response));
//   $('div#resultDiv').html('<p>'+ JSON.stringify(response) +'</p>');
// }
//****************************************************************

function testexecutethis() {
		try {
		var widParameters = JSON.parse(document.getElementById("function_parameters").value);
	} catch (e) {
		console.error("JSON Parsing error:", e);
		alert("JSON Parsing error:", e);
		return;
	}
	execute(widParameters, show_function_output);
}

function testconverttodot() {
	document.getElementById("divprint").innerHTML = "";
    var widParameters = JSON.parse(document.getElementById("function_parameters").value);
    // widParameters['executethis'] = ConvertToDOTdri;
	var getwidresult = ConvertToDOTdri(widParameters);
	Display_Output(getwidresult);
}

function testconvertfromdot() {
    document.getElementById("divprint").innerHTML = "";
    var widParameters = JSON.parse(document.getElementById("function_parameters").value);
    // widParameters['executethis'] = ConvertFromDOTdri;
	var getwidresult = ConvertFromDOTdri(widParameters);
	Display_Output(getwidresult);
}

function Display_Output(data) {
	document.getElementById("Function_Output").innerHTML =  "";
	text = "<br><span><br><pre style='background: #D1D5D5; color: #339300;'>" + JSON.stringify(data) + "</pre><br></span>";
	//$('#Function_Output').text(text);
	document.getElementById("Function_Output").innerHTML =  text;
}

function displayAllWids() {
	document.getElementById("divwidsdisplay_from_local_storage").innerHTML = "";
	var html = "";
	for(var key in localStorage) {
		//if(key.indexOf(widMasterKey) == 0){
			html += document.getElementById("divwidsdisplay_from_local_storage").innerHTML;
			html += "<label style='color: red; font-size: 85%;'>" + key + "</label>   ";
			// html += "<label style='color: purple; font-size: 85%;'>" + JSON.stringify(getFromLocalStorage(key)) + "</label><br>";
			html += "<label style='color: purple; font-size: 85%;'>" + localStorage.getItem(key) + "</label><br>";
			html += "<br>";
	}
	document.getElementById("divwidsdisplay_from_local_storage").innerHTML =  html;
}

function displaylocalStore () {
	document.getElementById("divwidsdisplay_from_memory").innerHTML = "";
	var html = "";
	var wid_storage = localStore.json;
	for(var key in wid_storage) {
		html += document.getElementById("divwidsdisplay_from_memory").innerHTML;
		html += "<label style='color: red; font-size: 85%;'>" + key + "</label>   ";
		var value = wid_storage[key];

		html += "<label style='color: purple; font-size: 85%;'>" + JSON.stringify(value) + "</label><br>";

		html += "<br>";
	}
	document.getElementById("divwidsdisplay_from_memory").innerHTML =  html;
}

function display_Store () {
	document.getElementById("local_data").innerHTML = "";
	var html = "";
	var wid_storage = localStore.json;
	for(var key in wid_storage) {
		html += document.getElementById("divwidsdisplay_from_memory").innerHTML;
		html += "<label style='color: red; font-size: 85%;'>" + key + "</label>   ";
		var value = wid_storage[key];

		html += "<label style='color: purple; font-size: 85%;'>" + JSON.stringify(value) + "</label><br>";

		html += "<br>";
	}
	document.getElementById("local_data").innerHTML =  html;
}

function display_Local_Storage() {
	document.getElementById("local_data").innerHTML = "";
	var html = "";
	for(var key in localStorage) {
		//if(key.indexOf(widMasterKey) == 0){
			html += document.getElementById("local_data").innerHTML;
			html += "<label style='color: red; font-size: 85%;'>" + key + "</label>   ";
			html += "<label style='color: purple; font-size: 85%;'>" + localStorage.getItem(key) + "</label><br>";
			html += "<br>";
			// html += "<label style='color: purple; font-size: 85%;'>" + JSON.stringify(getFromLocalStorage(key)) + "</label><br>";
	}
	document.getElementById("local_data").innerHTML =  html;
}

function display_local_wid() {
	document.getElementById("local_data").innerHTML = "";
	var html = "";
	// JSON.stringify(outobject, "-", 4);
	// var db = JSON.parse(localStorage['DRIKEY']);
	var db = JSON.stringify(JSON.parse(localStorage['DRIKEY']), "-", 4);
	// for (var i in db) {
	// 	html += "<label style='color: red; font-size: 85%;'>" + db[i].wid + "</label>   ";
	// 	html += "<label style='color: purple; font-size: 85%;'>" + JSON.stringify(db[i].data) + "</label><br><br>";
	// }
	document.getElementById("local_data").innerHTML = db;
}

$("input[name='output_type']").change(function() {
	if (document.getElementById('radio_short').checked) {
		$('#short_output').show('slow');
		$('#long_output').hide('slow');
	} else {
		$('#short_output').hide('slow');
		$('#long_output').show('slow');
	}
});

$("input[name='data_type']").change(function() {
	$("#local_data").hide('fast');
	if (document.getElementById('data_local_storage').checked) {
		display_Local_Storage();
	}
	if (document.getElementById('data_store').checked) {
		display_Store();
	}	
	if (document.getElementById('data_wid').checked) {
		display_local_wid();
	}
	$("#local_data").show('fast');
});



function isNumeric(elem, helperMsg){
	var numericExpression = /^[0-9]+$/;
	if(elem.value.match(numericExpression)){
		return true;
	}else{
		alert(helperMsg);
		elem.focus();
		return false;
	}
}
function checkBeforeSubmit(){
	if ((isNumeric(document.getElementById('numbers'), 'Please enter a number'))){
		document.getElementById('theForm').submit();
		document.getElementById('success').innerHTML='Submitted';
	}
}

</script>

<div id='google_data' style='display:none'>
	<iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>
	<form method="post" action="https://script.google.com/macros/s/AKfycbyy6Nu3M6EQZ7wyx4vIGOoe8xAZUkzKC1f2wlRcdn6VcatTc9w/exec" name="theForm" id="theForm" target="hidden_iframe" id="GoogleForm">
	<!-- <form method="post" action="https://script.google.com/macros/s/AKfycbwVOpk9j4HDMGsgHOw7BzGvpTBXYQLkZgVBpWxiVQo7oBvQmHEh/exec" name="theForm" id="theForm" target="hidden_iframe" id="GoogleForm"> -->
	  Name:
	  <input type="text" name="name" id="name"/>
	  <br />Comment:
	  <textarea name="comment" id="comment"></textarea>
	  <br />
	  Basic spam prevention (enter any 4 digit number): <input name="numbers" id="numbers" type="text">
	  <input type="button" value="Submit" class="submit"  onclick="checkBeforeSubmit();"/>
	  <span id="success"></span>
	  </div>
	</form>
</div>


</body>
</html>
